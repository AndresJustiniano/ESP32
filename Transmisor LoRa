#include <SPI.h>
#include <LoRa.h>
#include <HT_st7735.h>

// Configuración de la pantalla
HT_st7735 st7735; // Declaración del objeto de pantalla

// Configuración LoRa
#define BAND 915E6 // Frecuencia LoRa

void setup() {
  Serial.begin(9600);
  while (!Serial);

  // Inicializar LoRa
  if (!LoRa.begin(BAND)) {
    Serial.println("Error al inicializar LoRa");
    while (1);
  }
  Serial.println("LoRa inicializado");

  // Inicializar pantalla
  st7735.st7735_init(); // Inicializar la pantalla
  st7735.st7735_fill_screen(ST7735_BLACK); // Limpiar pantalla
  st7735.st7735_write_str(0, 0, "Transmisor Iniciado"); // Escribir texto inicial
  delay(2000); // Pausa inicial
}

void loop() {
  static int counter = 1; // Contador para los datos

  // Crear mensaje
  String message = String(counter);
  Serial.println("Enviando: " + message);

  // Enviar mensaje por LoRa
  LoRa.beginPacket();
  LoRa.print(message);
  LoRa.endPacket();

  // Mostrar mensaje en la pantalla
  st7735.st7735_fill_screen(ST7735_BLACK); // Limpiar pantalla
  st7735.st7735_write_str(0, 0, "Enviando:"); // Escribir título
  st7735.st7735_write_str(0, 20, message.c_str()); // Escribir el número enviado

  // Incrementar el contador
  counter = (counter % 10) + 1; // Resetear a 1 después del 10
  delay(2000); // Intervalo de 2 segundos
}


